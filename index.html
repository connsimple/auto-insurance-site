<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Connsimple Insurance</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 0; padding: 0; }
    header { background: #003366; color: white; padding: 20px; text-align: center; }
    section { padding: 40px; }
    form { max-width: 500px; margin: auto; background: #f9f9f9; padding: 20px; border-radius: 5px; }
    label { display: block; margin-top: 15px; }
    select, input { width: 100%; padding: 8px; margin-top: 5px; }
    #quote-summary { margin-top: 20px; padding: 15px; background: #e9f7ef; border: 1px solid #ccc; }
  </style>
  <script src="https://www.paypal.com/sdk/js?client-id=YOUR_PAYPAL_CLIENT_ID"></script>
</head>
<body>
  <header>
    <h1>Connsimple Insurance</h1>
    <p>Affordable Coverage Plans</p>
  </header>

  <section id="quote">
    <h2>Start Your Quote</h2>
    <form id="quote-form">
      <label for="plan">Choose Plan:</label>
      <select id="plan" required>
        <option value="basic">Basic - $90/mo</option>
        <option value="standard">Standard - $130/mo</option>
        <option value="full">Full - $175/mo</option>
      </select>

      <label for="duration">Choose Duration:</label>
      <select id="duration" required>
        <option value="6">6 Months</option>
        <option value="12">12 Months (25% off if paid in full)</option>
      </select>

      <label for="paymentType">Payment Option:</label>
      <select id="paymentType" required>
        <option value="monthly">Monthly Payments</option>
        <option value="full">Pay Full Amount</option>
      </select>

      <label for="name">Full Name:</label>
      <input type="text" id="name" required>

      <label for="email">Email:</label>
      <input type="email" id="email" required>

      <div id="quote-summary"></div>
      <div id="paypal-button-container" style="margin-top:20px;"></div>
    </form>
  </section>

  <script>
    const planPrices = { basic: 90, standard: 130, full: 175 };

    const form = document.getElementById("quote-form");
    const summaryDiv = document.getElementById("quote-summary");

    function calculateQuote() {
      const plan = document.getElementById("plan").value;
      const duration = parseInt(document.getElementById("duration").value);
      const paymentType = document.getElementById("paymentType").value;

      let monthlyRate = planPrices[plan];
      let total = monthlyRate * duration;

      if (duration === 12 && paymentType === "full") {
        total = total * 0.75; // 25% discount for yearly upfront
      }

      let summary = `<h3>Quote Summary</h3>`;
      summary += `<p>Plan: ${plan.charAt(0).toUpperCase() + plan.slice(1)}</p>`;
      summary += `<p>Duration: ${duration} months</p>`;
      if (paymentType === "monthly") {
        summary += `<p>Monthly Payment: $${monthlyRate}</p>`;
      } else {
        summary += `<p>Total Due (Full Payment): $${total}</p>`;
      }

      summaryDiv.innerHTML = summary;
      return { monthlyRate, total, paymentType, duration, plan };
    }

    form.addEventListener("change", calculateQuote);

    paypal.Buttons({
      createOrder: function(data, actions) {
        const { monthlyRate, total, paymentType } = calculateQuote();
        let amount = paymentType === "monthly" ? monthlyRate : total;

        return actions.order.create({
          purchase_units: [{ amount: { value: amount.toFixed(2) } }]
        });
      },
      onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
          alert("Payment successful! Policy documents will be sent to your email.");
          
          const formData = {
            name: document.getElementById("name").value,
            email: document.getElementById("email").value,
            ...calculateQuote()
          };

          // Call Netlify function to email binder & ID cards
          fetch("/.netlify/functions/sendPolicyEmail", {
            method: "POST",
            body: JSON.stringify(formData)
          });
        });
      }
    }).render("#paypal-button-container");

    calculateQuote(); // run once at load
  </script>
</body>
</html>
